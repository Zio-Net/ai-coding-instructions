---
description: Comprehensive best practices for .NET C# development, focusing on modern features, clean architecture, and maintainability.
globs: **/*.cs
alwaysApply: false
---

# .NET C# Development Guidelines

## Modern C# Features & Syntax
- **Immutable Records**: Prefer `record` or `record struct` for DTOs, command/query objects, and value objects to ensure immutability and concise syntax.
- **File-Scoped Namespaces**: Use file-scoped namespaces (`namespace MyNamespace;`) to reduce indentation nesting.
- **Primary Constructors**: Utilize primary constructors for classes and records where appropriate (C# 12+) to reduce boilerplate.
- **Pattern Matching**: Use pattern matching (`is`, `switch` expressions) for expressive control flow.
- **Global Usings**: Consolidate common imports in a `GlobalUsings.cs` file.

## Architecture & Design
- **Interfaces**: Always define interfaces (e.g., `IServiceName`) for services and business logic components to enable loose coupling and testability.
- **Dependency Injection**: strictly use Constructor Injection for dependencies. Avoid service locators.
- **Separation of Concerns**:
  - Keep logic out of controllers/endpoints; delegate to services/handlers.
  - Separate Domain models (Entities) from API models (DTOs, Requests, Responses).
- **Configuration**: Use `IOptions<T>` for strongly-typed configuration settings.

## Coding Standards
- **Naming Conventions**: Follow standard .NET naming conventions (PascalCase for public members/types, camelCase for parameters/locals, `_camelCase` for private fields).
- **Async/Await**: Use `async`/`await` for all I/O-bound operations. Always propagate `CancellationToken` where possible.
- **Nullability**: Enable Nullable Reference Types (`<Nullable>enable</Nullable>`) and handle potential nulls explicitly.
- **Exceptions**: Throw custom, semantic exceptions for domain logic failures. Use global exception handling middleware for API responses.

## Performance & Data
- **LINQ**: Use `AsNoTracking()` for read-only Entity Framework queries.
- **Pagination**: Implement pagination for endpoints returning collections.
- **Resource Management**: Ensure `IDisposable` objects are properly disposed (use `using` declarations).

## Testing
- **Unit Tests**: Test business logic in isolation using mocks for interfaces.
- **Integration Tests**: Verify end-to-end flows using `WebApplicationFactory` (for ASP.NET Core) or test containers.
- **Arrange-Act-Assert**: Follow the AAA pattern in tests.
